<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>RoboDock</title>
    <description>船塢日誌</description>
    <link>http://robodock.github.io//</link>
    <atom:link href="http://robodock.github.io//feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Sun, 12 Mar 2017 18:20:47 +0800</pubDate>
    <lastBuildDate>Sun, 12 Mar 2017 18:20:47 +0800</lastBuildDate>
    <generator>Jekyll v3.3.0</generator>
    
      <item>
        <title>用 Raspberry Pi3 打造車牌辨識系統</title>
        <description>&lt;p&gt;OpenALPR 為一開源車牌辨識程式庫(&lt;a href=&quot;https://github.com/openalpr/openalpr&quot;&gt;github連結&lt;/a&gt;)。&lt;/p&gt;

&lt;p&gt;最新的 Ubuntu 16.04 上已納入系統套件庫，可直接 apt-get 安裝，不過截至目前為止(2017/02) raspbian 上還沒有編譯好的套件，需要手動編譯安裝。&lt;/p&gt;

&lt;p&gt;這裡亦列出 Ubuntu 16.04 上的套件安裝方法供參考&lt;/p&gt;

&lt;h3 id=&quot;ubuntu-1604&quot;&gt;Ubuntu 16.04&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y openalpr openalpr-daemon openalpr-utils libopenalpr-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;用圖片檔測試結果：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ wget http://plates.openalpr.com/ea7the.jpg
$ alpr -c us ea7the.jpg

$ wget http://plates.openalpr.com/h786poj.jpg
$ alpr -c eu h786poj.jpg
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;raspberry-pi3--openalpr&quot;&gt;在 Raspberry Pi3 上安裝 OpenALPR&lt;/h1&gt;

&lt;p&gt;影像辨識向來都是 CPU intensive 應用，加上底下的程式編譯過程須花費長久時間，在 Pi3 上需要一個多小時的編譯時間，Pi2 應該也跑得動但編譯時間會增加，Pi1 就不建議了。&lt;/p&gt;

&lt;p&gt;系統使用 raspbian jessie，OpenALPR 需要 OpenCV 與 tesseract-ocr，可分別獨立安裝。&lt;/p&gt;

&lt;h2 id=&quot;opencv&quot;&gt;安裝 OpenCV&lt;/h2&gt;

&lt;p&gt;在 Raspberry Pi3 安裝 OpenCV 最詳盡的 step by step 步驟莫過於&lt;a href=&quot;http://www.pyimagesearch.com/2016/04/18/install-guide-raspberry-pi-3-raspbian-jessie-opencv-3/&quot;&gt;這篇&lt;/a&gt;了。摘要如下：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;確定記憶卡上有足夠的空間，下載與編譯需要用個 3~4G，我是用 8G 的卡安裝 raspbian lite，空間還夠用，記得使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo raspi-config&lt;/code&gt; 設定將檔案系統擴展到使用整張記憶卡空間。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;安裝編譯環境與工具&lt;/p&gt;

    &lt;p&gt;養成好習慣，先來個更新：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ sudo apt-get update
 $ sudo apt-get upgrade
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;安裝編譯環境與工具&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ sudo apt-get install build-essential cmake pkg-config
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;一些必要的相依性套件&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ sudo apt-get install libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev
 $ sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev
 $ sudo apt-get install libxvidcore-dev libx264-dev
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;要使用 OpenCV 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;highgui&lt;/code&gt; 圖形介面的需要這個：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ sudo apt-get install libgtk2.0-dev
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;矩陣數值運算會用到&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ sudo apt-get install libatlas-base-dev gfortran
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;需要 python 標頭檔&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ sudo apt-get install python2.7-dev python3-dev
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;下載 OpenCV 與 OpenCV_contrib 程式庫原始碼檔案並解壓縮：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ cd ~
 $ wget -O opencv.zip https://github.com/Itseez/opencv/archive/3.1.0.zip
 $ unzip opencv.zip
    
 $ wget -O opencv_contrib.zip https://github.com/Itseez/opencv_contrib/archive/3.1.0.zip
 $ unzip opencv_contrib.zip
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;接著來搞定 Python 環境，建議使用 virtualenv + virtualenvwrapper 建立獨立環境，可避免干擾系統相關 Python 程式庫。&lt;/p&gt;

    &lt;p&gt;首先先重新手動安裝 pip，為什麼要手動安裝? 因為 raspbian 系統的 pip 版本太舊了!&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ wget https://bootstrap.pypa.io/get-pip.py
 $ sudo python get-pip.py
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;安裝 virtualenv 與 virtualenvwrapper&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ sudo pip install virtualenv virtualenvwrapper
 $ sudo rm -rf ~/.cache/pip
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;修改 &lt;code class=&quot;highlighter-rouge&quot;&gt;~/.profile&lt;/code&gt;，在檔案最後加入下列幾行：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; # virtualenv and virtualenvwrapper
 export WORKON_HOME=$HOME/.virtualenvs
 source /usr/local/bin/virtualenvwrapper.sh
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;想要不登出，重新載入系統環境變數，可用：&lt;/p&gt;

    &lt;p&gt;想要使用 python 2 的：&lt;/p&gt;

 	$ mkvirtualenv cv2 -p python2

    &lt;p&gt;想要使用 python 3 的：&lt;/p&gt;

 	$ mkvirtualenv cv3 -p python3

    &lt;p&gt;上面的 cv2/cv3 是自己取的名稱，方便辨識即可&lt;/p&gt;

    &lt;p&gt;爾後要切換不同 python 環境，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;workon xx&lt;/code&gt; 即可，離開環境則使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;deactivate&lt;/code&gt; 指令，例如：&lt;/p&gt;

    &lt;p&gt;切換至名為 cv2 的 python 2 環境：&lt;/p&gt;

 	$ workon cv2

    &lt;p&gt;切換至名為 cv3 的 python 3 環境：&lt;/p&gt;

 	$ workon cv3

    &lt;p&gt;在系統提示符號前方會有一括號標示現在所處的 virtualenv 環境。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;開始編譯安裝 OpenCV&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ cd ~/opencv-3.1.0/
 $ mkdir build
 $ cd build
 $ cmake -D CMAKE_BUILD_TYPE=RELEASE \
     -D CMAKE_INSTALL_PREFIX=/usr/local \
     -D INSTALL_PYTHON_EXAMPLES=ON \
     -D OPENCV_EXTRA_MODULES_PATH=~/opencv_contrib-3.1.0/modules \
     -D BUILD_EXAMPLES=ON ..
 $ make -j4
 $ sudo make install
 $ sudo ldconfig
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;注意 python 2 與 python 3 環境編譯安裝的 CV2.so 檔名有些不同，python 2 版本安裝於 &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/lib/python2.7/site-packages/cv2.so&lt;/code&gt;， python 3 則安裝為 &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/local/lib/python3.4/site-packages/cv2.cpython-34m.so&lt;/code&gt;&lt;/p&gt;

    &lt;p&gt;在 virtualenv 環境中建立 cvs.so 檔連結&lt;/p&gt;

    &lt;p&gt;python 2 環境：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ cd ~/.virtualenvs/cv/lib/python2.7/site-packages/
 $ ln -s /usr/local/lib/python2.7/site-packages/cv2.so cv2.so
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;python 3 環境：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ cd ~/.virtualenvs/cv/lib/python3.4/site-packages/
 $ ln -s /usr/local/lib/python3.4/site-packages/cv2.cpython-34m.so cv2.so
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;測試&lt;/p&gt;

 	$ python
 	»&amp;gt; import cv2
 	»&amp;gt; cv2.&lt;strong&gt;version&lt;/strong&gt;
 	‘3.1.0’
 	»&amp;gt;

    &lt;p&gt;大功告成!&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;tesseract-ocr-&quot;&gt;安裝 tesseract-ocr 文字辨識程式庫&lt;/h2&gt;

&lt;p&gt;首先準備編譯工具，部分套件在安裝 OpenCV 時亦會安裝。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install autoconf automake libtool
sudo apt-get install autoconf-archive
sudo apt-get install pkg-config
sudo apt-get install libpng12-dev
sudo apt-get install libjpeg8-dev
sudo apt-get install libtiff5-dev
sudo apt-get install zlib1g-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;如果需要安裝辨識訓練工具，另需要下列套件&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt-get install libicu-dev
sudo apt-get install libpango1.0-dev
sudo apt-get install libcairo2-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;tesseract-ocr 需要 leptonica 影像演算法套件，先來安裝 leptonica 程式庫。&lt;/p&gt;

&lt;h3 id=&quot;leptonica&quot;&gt;安裝 leptonica&lt;/h3&gt;

&lt;p&gt;2017/02 版本&lt;a href=&quot;http://www.leptonica.org/source/leptonica-1.74.1.tar.gz&quot;&gt;下載&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;下載後解壓縮&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ tar xvzf leptonica-1.74.1.tar.gz
$ cd leptonica-1.74.1
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;兩種安裝方式，擇一使用&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;使用 autoconf&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; ./configure --prefix=/usr/local/
 make
 sudo make install
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用 cmake&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; mkdir build
 cd build
 cmake ..
 make
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;tesseract-ocr&quot;&gt;安裝 tesseract-ocr&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone --depth 1 https://github.com/tesseract-ocr/tesseract.git
cd tesseract
./autogen.sh
./configure --enable-debug LDFLAGS=&quot;-L/usr/local/lib&quot; CFLAGS=&quot;-I/usr/local/include&quot; 
make
sudo make install
sudo ldconfig
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;另外需要語言資料檔&lt;/p&gt;

&lt;p&gt;可從 &lt;code class=&quot;highlighter-rouge&quot;&gt;https://github.com/tesseract-ocr/tesseract/wiki/Data-Files&lt;/code&gt; 下載，存放於 tessdata 目錄&lt;/p&gt;

&lt;p&gt;可設定環境變數指定資料檔路徑&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;export TESSDATA_PREFIX=&quot;/usr/local/share/&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;openalpr&quot;&gt;安裝 OpenALPR&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git clone https://github.com/openalpr/openalpr.git
$ cd openalpr/src

修改 CMakeLists.txt， 加入下列兩行：
SET (OpenCV_DIR &quot;/home/pi/opencv-3.1.0/build&quot;)
SET (Tesseract_DIR &quot;/home/pi/tesseract&quot;)

$ cmake ./

如果出現 lib4cplus 找不到，請 `sudo apt-get install lib4cplus-dev`

$ make

如果出現 curl.h 找不到，請 `sudo apt-get install libcurl4-openssl-dev`

$ sudo make install
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;完成後下載個車牌圖片進行測試，加上 &lt;code class=&quot;highlighter-rouge&quot;&gt;--clock&lt;/code&gt; 參數，查看辨識計算時間&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ wget http://plates.openalpr.com/ea7the.jpg
$ alpr -c us ea7the.jpg --clock
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;底下是我的 Pi3 實際輸出結果，圖形處理加上辨識時間小於 1 秒，已達實用階段，如果再透過 GPIO 連接一些 sensor 與 relay 控制，應該可以實作出一簡易車牌辨識的停車場閘門系統吧? Oh Ye! Raspberry Pi 好棒棒!&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pi@raspberrypi:~ $ alpr -c us ea7the.jpg --clock
Info in bmfCreate: Generating pixa of bitmap fonts from string
Total Time to process image: 482.089ms.
plate0: 10 results -- Processing Time = 143.435ms.
    - EA7THE     confidence: 91.0578
    - EA7TBE     confidence: 84.133
    - EA7T8E     confidence: 83.0083
    - EA7TRE     confidence: 82.7869
    - EA7TE      confidence: 82.5961
    - EA7TME     confidence: 80.2908
    - EA7TH6     confidence: 77.0045
    - EA7THB     confidence: 75.5779
    - EA7TH      confidence: 74.6576
    - EA7TB6     confidence: 70.0797
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;section&quot;&gt;後記&lt;/h2&gt;

&lt;p&gt;影像辨識系統採用都是學習演算法，要提高精準度，就必須提供大量的圖片資料供學習，建立辨識樣式。然而每個國家與地區車牌樣式、尺寸、字體不盡相同，需針對每個地區的車牌建立學習資料庫。&lt;/p&gt;

&lt;p&gt;OpenALPR 目前已內建幾個區域如 US、EU、KR、SG 等樣式資料庫，但沒有台灣地區。加上台灣 2015 年改版的 7 位數車牌，字體與以往的舊系統大不相同，增加了辨識複雜度。&lt;/p&gt;

&lt;p&gt;實際以本地車牌測試，舊式車牌(2015年以前)，直接以 US 樣式比對，已有相當不錯的正確率，信心度最高的項目通常即為正確車牌，但若遇到新式車牌，則經常會有頭尾掉字或誤認情形。&lt;/p&gt;

&lt;p&gt;待有空時再來建立一個本地的車牌學習資料庫…&lt;/p&gt;
</description>
        <pubDate>Sun, 26 Feb 2017 20:21:00 +0800</pubDate>
        <link>http://robodock.github.io//2017/02/26/openalpr.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2017/02/26/openalpr.html</guid>
        
        
      </item>
    
      <item>
        <title>Windows Systinternals psexec 用法</title>
        <description>&lt;p&gt;&lt;strong&gt;Sysinternals Suite 是一套 Windows 環境下的進階系統工具程式，其中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;psexec&lt;/code&gt; 可用來在遠端電腦執行程式&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Usage:
psexec [\\\\computer[,computer2[,...] | @file]] [-u user] [-p passwd] [-n s] [-r servicename] [-h] [-l] [-s] [-e] [-x] [-i] [session]] [-c[-f|-v]][-w directory][-d][-&amp;lt;priority&amp;gt;][-a n,n,...] cmd [arguments]
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-a&lt;/code&gt; 指定程序使用哪一顆 CPU 來執行，例如 “-a 2,4” 表示使用 CPU 2 與 CPU 4.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-c&lt;/code&gt; 將程式複製到遠端電腦執行.若不指定則程式必須存在於遠端電腦系統路徑上.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-d&lt;/code&gt; 不等候程式執行完成(非互動式)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-e&lt;/code&gt; 不要載入指定帳號 profile.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-f&lt;/code&gt; 強制複製程式到遠端電腦(即使已存在)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-i&lt;/code&gt; 在遠端桌面上以互動方式執行，若不指定程式則執行命令列視窗.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-h&lt;/code&gt; 在 Vista 之後版本，以較高權限執行(如果有的話)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-l&lt;/code&gt; 去除管理者群組權限，改以限制使用者方式執行.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-n&lt;/code&gt; 指定連線逾時時間&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-p&lt;/code&gt; 指定使用者帳號密碼，未指定時會顯示提示要求輸入&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-r&lt;/code&gt; 指定要建立或溝通的遠端服務&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-s&lt;/code&gt; 以系統帳號執行程式&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-u&lt;/code&gt; 指定使用者帳號名稱&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-v&lt;/code&gt; 只有在程式較新或版次較高時才複製檔案到遠端電腦&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-W&lt;/code&gt; 設定程式的工作目錄(在遠端電腦上)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-x&lt;/code&gt; 顯示 Winlogon secure desktop UI(僅限本地端)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-priority&lt;/code&gt; 指定 -low, -belownormal, -abovenormal, -high, -realtime 優先順序，或使用 -background 在 Vista 以後系統以 low memory 與 I/O priority 方式執行.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;computer&lt;/code&gt; 遠端電腦名稱，未指定時表示在本地端執行&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@file&lt;/code&gt; 在 file 檔案中列出的電腦上執行程式.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cmd&lt;/code&gt; 要執行的程式名稱.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;arguments&lt;/code&gt; 程式參數(注意若有路徑名稱，需使用目標系統上的絕對路徑)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-accepteula&lt;/code&gt; 避免 license 對話框出現&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;程式名稱或檔案路徑中有空白字元時，需用雙引號框起來。&lt;/strong&gt;&lt;/p&gt;
</description>
        <pubDate>Thu, 08 Dec 2016 20:40:00 +0800</pubDate>
        <link>http://robodock.github.io//2016/12/08/psexec.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/12/08/psexec.html</guid>
        
        
      </item>
    
      <item>
        <title>GitHub fork 專案同步上游來源更新</title>
        <description>&lt;h2 id=&quot;github-fork-&quot;&gt;GitHub fork 專案同步上游原始來源的更新&lt;/h2&gt;

&lt;p&gt;從 GitHub 上 fork 下來的專案，當原始來源有更新後，要如何同步到自己的 fork repo 中? 至目前為止(2016/12)，尚無法直接在 GitHub 管理網頁上進行此動作，必須在本地端進行，步驟如下：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;將 fork 出來的專案 &lt;code class=&quot;highlighter-rouge&quot;&gt;clone&lt;/code&gt; 到本地端作業。&lt;/li&gt;
  &lt;li&gt;開啟 &lt;code class=&quot;highlighter-rouge&quot;&gt;git bash&lt;/code&gt;，切換到 clone 下來的專案目錄中。&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;先檢視一下目前的遠端 repo 設定。&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ git remote -v
 origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)
 origin  https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;新增名為 &lt;strong&gt;upstream&lt;/strong&gt; 的 “原始來源” repo 設定&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ git remote add upstream https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;確認一下遠端 repo 設定&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ git remote -v
 origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (fetch)
 origin    https://github.com/YOUR_USERNAME/YOUR_FORK.git (push)
 upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (fetch)
 upstream  https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY.git (push)
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;fetch&lt;/code&gt; 指令來取得上游來源的更新，上游 &lt;code class=&quot;highlighter-rouge&quot;&gt;master&lt;/code&gt; 分支中的更新，會加到本地端的 &lt;code class=&quot;highlighter-rouge&quot;&gt;upstream/master&lt;/code&gt; 新分支。&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ git fetch upstream
 remote: Counting objects: 75, done.
 remote: Compressing objects: 100% (53/53), done.
 remote: Total 62 (delta 27), reused 44 (delta 9)
 Unpacking objects: 100% (62/62), done.
 From https://github.com/ORIGINAL_OWNER/ORIGINAL_REPOSITORY
 * [new branch]      master     -&amp;gt; upstream/master
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;確定目前工作分支。&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ git checkout master
 Switched to branch 'master'
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;merge&lt;/code&gt; 來將上游更新加入本地端。&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; $ git merge upstream/master
 Updating a422352..5fdff0f
 Fast-forward
  README                    |    9 -------
  README.md                 |    7 ++++++
  2 files changed, 7 insertions(+), 9 deletions(-)
  delete mode 100644 README
  create mode 100644 README.md
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;若上游更新部分與本地端有衝突則需另行處理。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;在本地端整合完成後，再 push 回自己 GitHub 上的 fork repo。&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ git push origin master
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Mon, 05 Dec 2016 14:12:11 +0800</pubDate>
        <link>http://robodock.github.io//2016/12/05/github-fork-sync.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/12/05/github-fork-sync.html</guid>
        
        
      </item>
    
      <item>
        <title>Wordpress 建立 child theme</title>
        <description>&lt;p&gt;&lt;strong&gt;Wordpress 中的 child theme 可繼承 parent theme 的所有功能與樣式，但又可同時自訂修改自有樣式。
在網站中使用 child theme 可避免當 parent theme 更新時，影響到自訂部分。&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;child-theme&quot;&gt;建立 child theme&lt;/h3&gt;

&lt;p&gt;登入網頁伺服器主機，找到網站中的 theme 目錄，預設位置在 &lt;code class=&quot;highlighter-rouge&quot;&gt;wp-content/themes&lt;/code&gt; ，建立 child theme 子目錄，慣例可用 parenttheme-child 做名稱。此目錄底下則需要兩個檔案，&lt;code class=&quot;highlighter-rouge&quot;&gt;style.css&lt;/code&gt;、&lt;code class=&quot;highlighter-rouge&quot;&gt;functions.php&lt;/code&gt;。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;child theme directory&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;style.css&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;functions.php&lt;/strong&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;style.css&lt;/code&gt; 檔案內容必須開頭如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/*
 Theme Name:   Twenty Fifteen Child
 Theme URI:    http://example.com/twenty-fifteen-child/
 Description:  Twenty Fifteen Child Theme
 Author:       John Doe
 Author URI:   http://example.com
 Template:     twentyfifteen
 Version:      1.0.0
 License:      GNU General Public License v2 or later
 License URI:  http://www.gnu.org/licenses/gpl-2.0.html
 Tags:         light, dark, two-columns, right-sidebar, responsive-layout, accessibility-ready
 Text Domain:  twenty-fifteen-child
*/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;其中 &lt;code class=&quot;highlighter-rouge&quot;&gt;Template&lt;/code&gt; 為繼承對應的 parent theme，其他則依狀況修改對應自己的網站設定。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;functions.php&lt;/code&gt; 則用來引入 stylesheets，內容如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
function my_theme_enqueue_styles() {

    $parent_style = 'parent-style'; // This is 'twentyfifteen-style' for the Twenty Fifteen theme.

    wp_enqueue_style( $parent_style, get_template_directory_uri() . '/style.css' );
    wp_enqueue_style( 'child-style',
        get_stylesheet_directory_uri() . '/style.css',
        array( $parent_style ),
        wp_get_theme()-&amp;gt;get('Version')
    );
}
add_action( 'wp_enqueue_scripts', 'my_theme_enqueue_styles' );
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;如果網站中使用多個 .css 檔，則必須分別加入 function 中。&lt;/p&gt;

&lt;p&gt;完成後即可在 Wordpress 佈景主題頁面中選取新增的 child theme 使用。&lt;/p&gt;
</description>
        <pubDate>Sat, 05 Nov 2016 10:20:00 +0800</pubDate>
        <link>http://robodock.github.io//2016/11/05/wordpress-child-theme.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/11/05/wordpress-child-theme.html</guid>
        
        
      </item>
    
      <item>
        <title>使用 Vagrant 輕鬆管理虛擬機</title>
        <description>&lt;h2 id=&quot;vagrant-&quot;&gt;使用 Vagrant 輕鬆管理虛擬機&lt;/h2&gt;

&lt;p&gt;vagrant 的觀念是這樣的，利用名為 &lt;strong&gt;Vagrantfile&lt;/strong&gt; 的虛擬機組態設定檔，達成可重複、快速部署的虛擬機環境。&lt;/p&gt;

&lt;p&gt;vagrant 本身並不提供虛擬化環境，而是站在巨人的肩膀上，使用 &lt;strong&gt;VirtualBox&lt;/strong&gt;、&lt;strong&gt;VMware&lt;/strong&gt; 等等虛擬化軟體，方便開發者快速建立&lt;strong&gt;“可拋棄式”&lt;/strong&gt;的系統，方便開發測試。透過使用相同的 Vagrantfile，不同的開發工作者亦可使用相同的系統環境，避免許多系統相容性問題。&lt;/p&gt;

&lt;p&gt;使用 Vagrant 時必須以 &lt;strong&gt;目錄&lt;/strong&gt; 為管理單位，有點類似 git 的觀念，首先在想要使用虛擬機的地方建立一個目錄(可想成一部虛擬機就是一個目錄)，起始 vagrant 環境設定後，便會在此目錄下建立 &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Vagrantfile&lt;/code&gt;&lt;/strong&gt; 組態檔與隱藏子目錄 &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;.vagrant&lt;/code&gt;&lt;/strong&gt; 存放系統控制相關資料。&lt;/p&gt;

&lt;h2 id=&quot;virtualbox--vagrant&quot;&gt;安裝 VirtualBox 與 Vagrant&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;前面提到 Vagrant 是架構其他虛擬化軟體之上，首先需要安裝虛擬機軟體，這裡使用免費的 VirtualBox，請自行至&lt;a href=&quot;https://www.virtualbox.org/&quot;&gt;官網&lt;/a&gt;下載最新版 VirtualBox。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;接著到 Vagrant &lt;a href=&quot;https://www.vagrantup.com/downloads.html&quot;&gt;官網&lt;/a&gt;下載最新版的 vagrant，依照指示完成安裝。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vagrant--1&quot;&gt;Vagrant 使用方法&lt;/h2&gt;

&lt;p&gt;基本流程步驟如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant init ubuntu/trusty64
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;表示在&lt;strong&gt;目前所在&lt;/strong&gt;目錄下初始化一個虛擬機環境，而使用系統範本為 &lt;code class=&quot;highlighter-rouge&quot;&gt;hashicorp/precise64&lt;/code&gt;。hashicorp 為創立 vagrant 的公司，官方提供許多不同 Linux 發行版本的系統範本供&lt;a href=&quot;https://atlas.hashicorp.com/boxes/search?provider=virtualbox&quot;&gt;下載&lt;/a&gt;，另外網路上亦可找到許多第三方提供之系統範本檔，此例中之 precise64 即為 Ubuntu 12.04 LTS 64-bit 版。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant up
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;啟動虛擬機。沒錯，就是這麼簡單，您的電腦中已經有個執行中的 Ubuntu 12.04 的 Linux 機器了。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant ssh
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;透過 ssh 連線至剛剛執行的 Ubuntu 機器。注意，如果是在 Windows 下，若系統中未裝過其他可提供 &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; 的環境(例如 &lt;code class=&quot;highlighter-rouge&quot;&gt;cygwin&lt;/code&gt;、&lt;code class=&quot;highlighter-rouge&quot;&gt;git&lt;/code&gt;等)，可能無法透過此方式連線，必須自己使用像是 &lt;code class=&quot;highlighter-rouge&quot;&gt;putty&lt;/code&gt; 之類的 ssh client 程式，vagrant 虛擬機預設的 SSH 連線位址與埠號為：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;host 127.0.0.1
port : 2222
username : vagrant
password : vagrant
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;結束 vagrant 虛擬機有三種方式：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant suspend
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;會將目前執行階段儲存，當下次執行 &lt;code class=&quot;highlighter-rouge&quot;&gt;vagrant up&lt;/code&gt; 後，可快速回復。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant halt
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;會在虛擬機中進行關機動作，但仍保留虛擬機的磁碟映像檔。下次執行 vagrant up 時，等同於冷開機。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant destroy
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;結束虛擬機並移除虛擬機映像檔。當下次執行 &lt;code class=&quot;highlighter-rouge&quot;&gt;vagrant up&lt;/code&gt; 時，會等同於重新從 boxes 中 clone 一份建立新的虛擬機磁碟映像檔。&lt;/p&gt;

&lt;h2 id=&quot;vagrant--2&quot;&gt;增加 Vagrant 虛擬機範本&lt;/h2&gt;

&lt;p&gt;前述的 &lt;code class=&quot;highlighter-rouge&quot;&gt;vagrant init hashicorp/precise64&lt;/code&gt; 動作，事實上會從 hashicorp 下載一個標準精簡版的 Ubuntu 12.04 precise 64-bit 系統，稱為 &lt;code class=&quot;highlighter-rouge&quot;&gt;Vagrant Boxes&lt;/code&gt;，爾後想再建立同樣的系統時，便可直接 clone，使用者啟動虛擬機後，此 Box 檔是不會被修改的，所有的異動部分只存在於虛擬機目錄中。&lt;/p&gt;

&lt;p&gt;我們可以先在系統中增加一些常用 Boxes，使用時便不須重新下載。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant box add ubuntu/trusty64
$ vagrant box add debian/jessie64
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;移除已下載的 Boxes：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant box remove xx/xx
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;更新 Boxes 虛擬機範本檔&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vagrant box update --box debian/jessie64
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;註： 結束並移除 vagrant 虛擬機的指令 &lt;code class=&quot;highlighter-rouge&quot;&gt;$ vagrant destroy&lt;/code&gt; 只是移除虛擬機的映像檔，並不會移除 box，要移除 box 需要使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;$ vagrant box remove&lt;/code&gt; 指令。&lt;/p&gt;

&lt;h2 id=&quot;provisioning-&quot;&gt;Provisioning 功能&lt;/h2&gt;

&lt;p&gt;Vagrant Boxes 通常僅包含基本作業系統，當然我們可以啟動虛擬機後再自行安裝各種軟體，但是如果我們想要建立一個可重複使用、包含特定軟體環境(例如 Apache+MySQL+PHP)，便是 Provision 的功能了。&lt;/p&gt;

&lt;h3 id=&quot;provisioning--1&quot;&gt;Provisioning 執行的時間點：&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;vagrant up 首次執行時(會自動建立環境設定)。如果環境已經建立，vagrant up 只是重啟虛擬機，此時並不會進行 provisioning。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;在執行環境中執行 vagrant provision&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;執行 vagrant reload –provision&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;basic-provisioning&quot;&gt;Basic Provisioning&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;config.vm.provision &quot;shell&quot;, inline: &quot;echo hello&quot;	

或是

config.vm.provision &quot;bootstrap&quot;, type: &quot;shell&quot; do |s|
	s.inline = &quot;echo hello&quot;
  	end

第一個參數為 provision 名稱，type 指定 provision 形式
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;file-provisioner&quot;&gt;File Provisioner&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;config.vm.provision &quot;file&quot;, source: &quot;~/.gitconfig&quot;, destination: &quot;.gitconfig&quot;

source: host 上的檔案位置
destination: 虛擬機上要存放的位置
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;shell-provisioner&quot;&gt;Shell Provisioner&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;inline 方式&lt;/p&gt;

   	config.vm.provision “shell”, inline: “echo Hello, World”
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;path 方式&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.provision &quot;shell&quot;, path: &quot;script.sh&quot;
  config.vm.provision &quot;shell&quot;, path: &quot;https://example.com/provisioner.sh&quot;
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;進階設定&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;啟用 VirtualBox 圖形介面&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.provider &quot;virtualbox&quot; do |v|
		v.gui = true
  end
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;自訂 VM 主機名稱&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.provider &quot;virtualbox&quot; do |v|
		v.name = &quot;my_vm&quot;
  end
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;有種使用方式稱為 Linked Clones，當第一個 VM(稱為 Master VM)從 box clone 建立後，爾後建立的 VM 可以不需要再從 box clone 一份，而是直接連結 Master VM，以此方式建立的 VM 僅包含異動於 Master VM 的部分，因此負擔較小。&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.provider &quot;virtualbox&quot; do |v|
		v.linked_clone = true
  end
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;CPU 與 memory 設定&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.provider &quot;virtualbox&quot; do |v|
		v.memory = 1024
		v.cpus = 2
  end
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-1&quot;&gt;網路設定&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Vagrant 支援 VirtualBox 的 internal network (即同個 Host 下建立的 VM 彼此為區網互通)：&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.network &quot;private_network&quot;, ip: &quot;192.168.50.4&quot;,
  		virtualbox__intnet: true
  end
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;若僅使用 “private_network” 設定，則為 host-only (VM 僅能與 Host 溝通)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vagrant--docker&quot;&gt;Vagrant 使用 Docker&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Vagrant 可以直接使用 Docker registry 提供的 image:&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.provider &quot;docker&quot; do |d|
     d.image = &quot;foo/bar&quot;
  end
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;當執行 vagrant up –provider=docker 時，便會使用 foo/bar image&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;或是使用 Dockerfile 自行建立 docker image&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  config.vm.provider &quot;docker&quot; do |d|
  		d.build_dir = &quot;.&quot;
  end
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;當執行 vagrant up –provider=docker時，vagrant 會在所在目錄下尋找 Dockerfile，並依此建立 docker container。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;在原生系統無法支援 Linux container 的環境，例如 Windows，Vagrant 會自動執行一個 &lt;strong&gt;“host VM”&lt;/strong&gt; 來執行 Docker，預設使用名為 &lt;strong&gt;“boot2docker”&lt;/strong&gt; 的輕量 box，可加快啟動速度。如果需要，亦可指定其他的 box 作為 host VM。另外在一個 host VM 中可執行多個 docker container。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;指定自訂的 vagtantfile 作為啟動 Docker 的 host VM。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;一些 vagrant 與 Docker container 溝通的指令：&lt;/p&gt;

    &lt;p&gt;查看 container 執行記錄檔資訊&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ vagrant docker-logs
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;

    &lt;p&gt;啟動 container 中的 prog 程式&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ vagrant docker-run container -- prog
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Wed, 02 Nov 2016 10:52:23 +0800</pubDate>
        <link>http://robodock.github.io//2016/11/02/vagrant.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/11/02/vagrant.html</guid>
        
        
      </item>
    
      <item>
        <title>Let's Encrypt 免費網站憑證</title>
        <description>&lt;h1 id=&quot;certbot-acme-client-&quot;&gt;使用 Certbot ACME client 自動化流程&lt;/h1&gt;

&lt;p&gt;Let’s Encrypt 建議使用 EFF 的 Certbot ACME client 進行自動化流程，
Certbot 網頁 &lt;a href=&quot;https://certbot.eff.org&quot;&gt;(https://certbot.eff.org)&lt;/a&gt; 提供各種不同網頁伺服器與作業系統的安裝說明。&lt;/p&gt;

&lt;h2 id=&quot;centosrhel-7&quot;&gt;CentOS/RHEL 7&lt;/h2&gt;

&lt;p&gt;Certbot 已經成為 EPEL 的套件之一，安裝 EPEL 套件庫後即可安裝。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo yum install epel-release
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;nginx-&quot;&gt;使用 Nginx 伺服器&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;直接安裝 certbot&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ sudo yum install certbot
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用 certbot 來取得所需憑證&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ certbot certonly
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;如果已有執行中的 Web Server，可利用 “webroot” plugin，在網頁目錄中做設定&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ certbot certonly --webroot -w /var/www/example -d example.com -d www.example.com -w /var/www/thing -d thing.is -d m.thing.is
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;如果要取得 “standalone” webserver 的憑證，須先停止 server daemon&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ certbot certonly --standalone -d example.com -d www.example.com
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;apache-&quot;&gt;使用 Apache 伺服器&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;安裝 python-certbot-apache&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ yum install python-certbot-apache
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用 Apache Plugin 進行自動設定&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ certbot --apache
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;或僅要取得憑證&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ certbot --apache certonly
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section&quot;&gt;自動更新&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Let’s Encrypt 憑證有效期僅為 90 天，建議設定自動更新&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ certbot renew --dry-run
  測試成功後，可利用 cron 或 systemd 排定定期工作(官網建議一天檢查兩次)
  $ certbot renew --quiet
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;centosrhel-6&quot;&gt;CentOS/RHEL 6&lt;/h2&gt;

&lt;p&gt;首先安裝 EPEL 套件庫&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo yum install epel-release
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;CentOS 6 尚未有 Certbot 套件，須手動安裝&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ wget https://dl.eff.org/certbot-auto
$ chmod a+x certbot-auto
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;使用 certbot 來取得所需憑證&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ./certbot-auto
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;nginx--1&quot;&gt;使用 Nginx 伺服器&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;僅取得憑證&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ ./path/to/certbot-auto certonly
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;使用 “webroot” plugin, 自動對網站目錄進行設定&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ $ ./path/to/certbot-auto certonly --webroot -w /var/www/example -d example.com -d www.example.com -w /var/www/thing -d thing.is -d m.thing.is
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;apache--1&quot;&gt;使用 Apache 伺服器&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;使用 Apache Plugin 進行自動設定&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ ./path/to/certbot-auto --apache
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;或僅要取得憑證&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ ./path/to/certbot-auto --apache certonly
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-1&quot;&gt;自動更新&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Let’s Encrypt 憑證有效期僅為 90 天，建議設定自動更新&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  $ ./path/to/certbot-auto renew --dry-run
  測試成功後，可利用 cron 或 systemd 排定定期工作(官網建議一天檢查兩次)
  $ ./path/to/certbot-auto renew --quiet
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section-2&quot;&gt;運作原理&lt;/h2&gt;

&lt;p&gt;在網站伺服器上執行一個憑證管理代理程式，使用 ACME protocol 來向 Let’s Encrypt CA 自動取得瀏覽器信任憑證。&lt;/p&gt;

&lt;p&gt;分為兩個階段：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;代理程式向 CA 證明網頁伺服器具有 domain 控制權。&lt;/li&gt;
  &lt;li&gt;代理程式可請求、更新、撤銷管理 domain 的憑證。&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;階段 1 : &lt;strong&gt;網域驗證&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;假設網站域名為 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt;
  當代理程式第一次聯繫 Let’s Encrypt CA 時，會產生一組新的金鑰對供後續使用。
  流程開始，代理程式詢問 CA，需要做些什麼來證明網站對 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt; 網域有控制權。
  CA 將會尋找域名並要求一或數個質問挑戰，可能為：&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;提供 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt; 下的 DNS record&lt;/li&gt;
      &lt;li&gt;提供 Well-known URI &lt;code class=&quot;highlighter-rouge&quot;&gt;https://example.com/&lt;/code&gt; 下的 HTTP resource&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;伴隨著質問挑戰，CA 也會提供一次性隨機數(nonce)要求代理程式以私鑰簽署，以證明代理程式對金鑰對有控制權。&lt;/p&gt;

    &lt;p&gt;代理程式會回應挑戰，並在 &lt;code class=&quot;highlighter-rouge&quot;&gt;https://example.com&lt;/code&gt; 網站特定路徑下建立一個檔案，同時對 CA 提供的一次性隨機數(nonce)以私鑰簽署。完成這些步驟後，便通知 CA 已準備好檢驗。&lt;/p&gt;

    &lt;p&gt;接下來便是 CA 的工作，CA 會檢驗一次性隨機數(nonce)的簽署，並嘗試從網站下載代理程式準備的檔案，確定內容正確。
  一切檢查成功後，此 key pair 便會做為 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;已驗證金鑰對&lt;/code&gt;。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;階段 2 : &lt;strong&gt;發證與撤銷&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;有了 &lt;code class=&quot;highlighter-rouge&quot;&gt;已驗證金鑰對&lt;/code&gt; 後，接下來的請求、更新、撤銷憑證動作就簡單了，只要送出使用金鑰對簽署的憑證管理請求即可。&lt;/p&gt;

    &lt;p&gt;請求憑證時，代理程式會建構一個 &lt;code class=&quot;highlighter-rouge&quot;&gt;PKCS#10&lt;/code&gt; 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;CSR&lt;/code&gt;(Certificate Signing Request)，請求 CA 以對應公鑰發出 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt; 的憑證。&lt;/p&gt;

    &lt;p&gt;CSR 中包含以私鑰對 CSR 中公鑰的簽署，同時代理程式也會用 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt; 的驗證金鑰對整個 CSR 進行簽署。&lt;/p&gt;

    &lt;p&gt;當 Let’s Encrypt CA 收到請求後，會檢查兩者，如果一切正常，將以 Public key 發出 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt; 的憑證回傳給代理程式。&lt;/p&gt;

    &lt;p&gt;撤銷憑證時，agent 以 &lt;code class=&quot;highlighter-rouge&quot;&gt;example.com&lt;/code&gt; 驗證金鑰簽發撤銷請求。如果 CA 檢查正確，會將撤銷資訊發布至 &lt;code class=&quot;highlighter-rouge&quot;&gt;撤銷 Channel 中&lt;/code&gt; (CRLs, OCSP)，各家的瀏覽器得以更新採用。&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Mon, 24 Oct 2016 14:08:00 +0800</pubDate>
        <link>http://robodock.github.io//server/2016/10/24/letsencrypt.html</link>
        <guid isPermaLink="true">http://robodock.github.io//server/2016/10/24/letsencrypt.html</guid>
        
        
        <category>server</category>
        
      </item>
    
      <item>
        <title>influxDB 使用 HTTP API 寫入資料</title>
        <description>&lt;h1 id=&quot;http-api--influxdb&quot;&gt;使用 HTTP API 寫入資料到 influxDB&lt;/h1&gt;

&lt;h2 id=&quot;http-api-&quot;&gt;使用 HTTP API 建立資料庫&lt;/h2&gt;
&lt;p&gt;透過傳送一個 HTTP &lt;code class=&quot;highlighter-rouge&quot;&gt;POST&lt;/code&gt; 請求至 &lt;code class=&quot;highlighter-rouge&quot;&gt;/query&lt;/code&gt; 網頁端點並設定參數 &lt;code class=&quot;highlighter-rouge&quot;&gt;q=CREATE DATABASE &amp;lt;new_database_name&amp;gt;&lt;/code&gt;，可建立資料庫：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -i -XPOST http://localhost:8086/query --data-urlencode &quot;q=CREATE DATABASE mydb&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;http-api--1&quot;&gt;使用 HTTP API 寫入資料&lt;/h2&gt;
&lt;p&gt;透過傳送一個 HTTP &lt;code class=&quot;highlighter-rouge&quot;&gt;POST&lt;/code&gt; 請求至 &lt;code class=&quot;highlighter-rouge&quot;&gt;/write&lt;/code&gt; 網頁端點並指定相關參數，可將資料寫入 influxDB 資料庫。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -i -XPOST 'http://localhost:8086/write?db=mydb' --data-binary 'cpu_load_short,host=server01,region=us-west value=0.64 1434055562000000000'
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;上述命令會將一筆資料寫入名為 &lt;code class=&quot;highlighter-rouge&quot;&gt;mydb&lt;/code&gt; (透過指定 &lt;code class=&quot;highlighter-rouge&quot;&gt;db=mydb&lt;/code&gt;) 的資料庫，資料如下：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;measurement : &lt;code class=&quot;highlighter-rouge&quot;&gt;cpu_load_short&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;tag keys : &lt;code class=&quot;highlighter-rouge&quot;&gt;host=server01,region=us-west&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;fidle key : &lt;code class=&quot;highlighter-rouge&quot;&gt;value=0.64&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;timestamp : &lt;code class=&quot;highlighter-rouge&quot;&gt;1434055562000000000&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;資料格式&lt;/h2&gt;

&lt;p&gt;上述的資料型式即為典型的 influxDB 資料格式，influxDB 稱這為 &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Line Protocol&lt;/code&gt;&lt;/strong&gt; ，說明如下：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;measurement : 記錄項目&lt;/li&gt;
  &lt;li&gt;tags : 選項欄位，用來標記不同資料來源或地點，有利於查詢效率。tag keys 與 tag values 皆為 &lt;strong&gt;字串&lt;/strong&gt; 格式。&lt;/li&gt;
  &lt;li&gt;fields : 資料數值欄位。field keys 為 &lt;strong&gt;字串&lt;/strong&gt; 格式，而 field value &lt;strong&gt;預設格式&lt;/strong&gt; 則為 &lt;strong&gt;float(浮點小數)&lt;/strong&gt;。&lt;/li&gt;
  &lt;li&gt;timestamp : epoch 格式，但以 nanosecond 單位記錄(所以總位數為19位數)。在 influxDB 中，所有時間皆以 UTC 記錄。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section-1&quot;&gt;寫入多點資料&lt;/h3&gt;
&lt;p&gt;多筆資料只要以 &lt;strong&gt;new line &lt;code class=&quot;highlighter-rouge&quot;&gt;\n&lt;/code&gt;&lt;/strong&gt; 字元分隔，即可在一個 HTTP 請求中，寫入多筆資料到資料庫中，效率也會比分開多次 HTTP 請求來的好。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;註：僅能使用 new line 字元 &lt;code class=&quot;highlighter-rouge&quot;&gt;\n&lt;/code&gt;，不可使用 new line + carriage return &lt;code class=&quot;highlighter-rouge&quot;&gt;\n\r&lt;/code&gt; 作為分隔。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;例如：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -i -XPOST 'http://localhost:8086/write?db=mydb' --data-binary 'cpu_load_short,host=server02 value=0.67
cpu_load_short,host=server02,region=us-west value=0.55 1422568543702900257
cpu_load_short,direction=in,host=server01,region=us-west value=2.0 1422568543702900257'
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-2&quot;&gt;讀取檔案來寫入&lt;/h3&gt;
&lt;p&gt;透過傳遞 &lt;code class=&quot;highlighter-rouge&quot;&gt;@filename&lt;/code&gt; 參數給 &lt;code class=&quot;highlighter-rouge&quot;&gt;curl&lt;/code&gt;，可將整個檔案資料寫入資料庫，當然檔案內容格式必須遵循前述的 &lt;code class=&quot;highlighter-rouge&quot;&gt;Line Protocol&lt;/code&gt;，注意換行符號僅使用 &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;\n&lt;/code&gt;&lt;/strong&gt;，而非 windows 環境下使用的 &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;\n\r&lt;/code&gt;&lt;/strong&gt; 換行字元，在 windows 環境中編輯資料檔案時須特別注意，建議使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;notepad++&lt;/code&gt; 之類的文書軟體來處理資料檔案。&lt;/p&gt;

&lt;p&gt;例如：名為 &lt;code class=&quot;highlighter-rouge&quot;&gt;cpu_data.txt&lt;/code&gt; 的檔案中資料如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cpu_load_short,host=server02 value=0.67
cpu_load_short,host=server02,region=us-west value=0.55 1422568543702900257
cpu_load_short,direction=in,host=server01,region=us-west value=2.0 1422568543702900257
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;將 &lt;code class=&quot;highlighter-rouge&quot;&gt;cpu_data.txt&lt;/code&gt; 檔案寫入 &lt;code class=&quot;highlighter-rouge&quot;&gt;mydb&lt;/code&gt; 資料庫 :&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -i -XPOST 'http://localhost:8086/write?db=mydb' --data-binary @cpu_data.txt
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;註：建議單一個檔案的資料少於 5000 點，以避免 HTTP request times out 相關問題。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;schemaless-design&quot;&gt;Schemaless Design&lt;/h2&gt;
&lt;p&gt;influxDB 是一種 Schemaless 資料庫，資料庫不需要固定樣式的資料表，可隨時加入額外的 measuremen、tag、field。
但對於已使用中的欄位，則須維持相通的資料格式，不可變更。例如原本使用 &lt;strong&gt;integers&lt;/strong&gt; 的欄位，則無法改寫入 &lt;strong&gt;string&lt;/strong&gt; 格式資料。&lt;/p&gt;

&lt;h2 id=&quot;http-&quot;&gt;關於 HTTP 回應訊息&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;2xx : &lt;code class=&quot;highlighter-rouge&quot;&gt;HTTP 204 No Content&lt;/code&gt; 與 &lt;code class=&quot;highlighter-rouge&quot;&gt;HTTP 200 OK&lt;/code&gt; 皆代表處理成功。&lt;/li&gt;
  &lt;li&gt;4xx : influxDB 無法處理請求&lt;/li&gt;
  &lt;li&gt;5xx : 系統超載或受損&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sat, 15 Oct 2016 19:57:00 +0800</pubDate>
        <link>http://robodock.github.io//2016/10/15/influxdb-http-api-write-data.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/10/15/influxdb-http-api-write-data.html</guid>
        
        
      </item>
    
      <item>
        <title>influxDB 備份與回復</title>
        <description>&lt;h1 id=&quot;influxdb-&quot;&gt;influxDB 備份與回復&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;influxDB 具備對某個時間點實施&lt;strong&gt;“快照”&lt;/strong&gt;與回存的能力。&lt;/li&gt;
  &lt;li&gt;influxDB 的備份接為完全備份，目前尚不支援&lt;strong&gt;“增量備份”&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;有兩種資料型式需要備份&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;metastore&lt;/strong&gt; : 資料庫的系統資訊，一次備份整個系統資訊。&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;metrics&lt;/strong&gt; : 資料內容，依各個資料庫分別備份。&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;註：開源版的 OSS influxDB 與 企業版的 InfluxEnterprise 資料庫備份無法互通使用&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;metastore-&quot;&gt;Metastore 備份&lt;/h2&gt;

&lt;p&gt;influxDB metastore 包含系統狀態、使用者資訊、資料庫、標記資料等等資訊。當節點執行時，可執行底下命令進行備份：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;influxd backup &amp;lt;path-to-backup&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;命令未加入任何參數時，備份目前狀態&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ influxd backup /tmp/backup
2016/02/01 17:15:03 backing up metastore to /tmp/backup/meta.00
2016/02/01 17:15:03 backup complete
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;database-&quot;&gt;Database 備份&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;每個資料需要分開單獨備份&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;加入 &lt;code class=&quot;highlighter-rouge&quot;&gt;-database&lt;/code&gt; 參數來備份資料庫：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;influxd backup -database &amp;lt;mydatabase&amp;gt; &amp;lt;path-to-backup&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;其他參數選項：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-retention &amp;lt;retention policy name&amp;gt;&lt;/code&gt; : 使用特定的資料庫保留策略來進行備份&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-shard &amp;lt;shard ID&amp;gt;&lt;/code&gt; : 使用特定的 shard ID 進行備份&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-since &amp;lt;data&amp;gt;&lt;/code&gt; : 指定備份特定的時間起的資料，時間戳記需使用 RFC3339 格式，(例如 &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;2015-12-24T08:12:23Z&lt;/code&gt;&lt;/strong&gt;)，使用指定時間的方式可間接達成增量備份的目的。&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;註：Database 的備份中同時也會包含 Metastore 資料備份&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;範例：針對名為 &lt;code class=&quot;highlighter-rouge&quot;&gt;telegraf&lt;/code&gt; 的資料庫，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;autogen&lt;/code&gt; 策略，從 2016/2/1 起進行&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ influxd backup -database telegraf -retention autogen -since 2016-02-01T00:00:00Z /tmp/backup
2016/02/01 18:02:36 backing up rp=default since 2016-02-01 00:00:00 +0000 UTC
2016/02/01 18:02:36 backing up metastore to /tmp/backup/meta.01
2016/02/01 18:02:36 backing up db=telegraf rp=default shard=2 to /tmp/backup/telegraf.default.00002.01 since 2016-02-01 00:00:00 +0000 UTC
2016/02/01 18:02:36 backup complete
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section&quot;&gt;遠端備份&lt;/h2&gt;
&lt;p&gt;使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;-host&lt;/code&gt; 參數，指定遠端主機位址與埠號，可對遠端主機進行備份：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ influxd backup -database mydatabase -host 10.0.0.1:8088 /tmp/mysnapshot
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;section-1&quot;&gt;資料庫回復&lt;/h2&gt;

&lt;p&gt;使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;influxd restore&lt;/code&gt; 命令來復原資料庫。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;註：只有在資料庫 daemon 停止執行時，才能進行資料庫回復動作。&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;復原資料庫時，須指定備份型式，資料庫位置與備份檔所在位置：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;influxd restore [ -metadir | -datadir ] &amp;lt;path-to-meta-or-data-directory&amp;gt; &amp;lt;path-to-backup&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-metadir &amp;lt;path-to-meta-directory&amp;gt;&lt;/code&gt; 如果使用來自系統套件安裝方式，資料庫 metastore 位置應該在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/influxdb/meta&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-datadir &amp;lt;path-to-data-directory&amp;gt;&lt;/code&gt; 如果使用來自系統套件安裝方式，資料庫 metastore 位置應該在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/influxdb/data&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;其他回復資料庫參數：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-database &amp;lt;database&amp;gt;&lt;/code&gt; 指定要回復的資料庫名稱，如果回復的資料型式為 data(亦即指定 &lt;code class=&quot;highlighter-rouge&quot;&gt;-datadir&lt;/code&gt;參數後)，此項參數為必要項目。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-retention &amp;lt;retention policy&amp;gt;&lt;/code&gt; 指定特定的保留策略。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;-shard &amp;lt;shard id&amp;gt;&lt;/code&gt; 指定回復特定的 shard data，須配合 &lt;code class=&quot;highlighter-rouge&quot;&gt;-database&lt;/code&gt; 與 &lt;code class=&quot;highlighter-rouge&quot;&gt;-retention&lt;/code&gt; 參數使用。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;資料庫回復範例：&lt;/p&gt;

&lt;p&gt;首先必須復原 metastore 資料，influxDB 才知道有哪些資料庫存在。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ influxd restore -metadir /var/lib/influxdb/meta /tmp/backup
Using metastore snapshot: /tmp/backup/meta.00
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;metastore 資料復原後，再進行資料部分復原，以前述的 &lt;code class=&quot;highlighter-rouge&quot;&gt;telegraf&lt;/code&gt; 資料庫例子：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ influxd restore -database telegraf -datadir /var/lib/influxdb/data /tmp/backup                                                                         
Restoring from backup /tmp/backup/telegraf.*
unpacking /var/lib/influxdb/data/telegraf/default/2/000000004-000000003.tsm
unpacking /var/lib/influxdb/data/telegraf/default/2/000000005-000000001.tsm
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;當資料庫復原後，shards 上的權限可能不正確，可使用下列命令，確保檔案權限正確：&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;$ sudo chown -R influxdb:influxdb /var/lib/influxdb&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;資料庫復原動作完成後，重新啟動資料庫&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ service influxdb start
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;可簡單快速執行資料庫查詢命令 &lt;code class=&quot;highlighter-rouge&quot;&gt;show database&lt;/code&gt;，確定資料庫回復成功：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;influx -execute 'show databases'
name: databases
---------------
name
_internal
telegraf
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Sat, 15 Oct 2016 19:48:00 +0800</pubDate>
        <link>http://robodock.github.io//2016/10/15/influxdb-backup.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/10/15/influxdb-backup.html</guid>
        
        
      </item>
    
      <item>
        <title>Grafana 安裝程序</title>
        <description>&lt;h1 id=&quot;grafana&quot;&gt;透過套件管理程式安裝 Grafana&lt;/h1&gt;

&lt;h2 id=&quot;centos&quot;&gt;CentOS&lt;/h2&gt;
&lt;p&gt;直接安裝最新穩定版&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo yum install https://grafanarel.s3.amazonaws.com/builds/grafana-3.1.1-1470047149.x86_64.rpm
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或者將 grafana 加入套件庫清單，
建立 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/yum.repos.d/grafana.repo&lt;/code&gt; 檔案，爾後便可使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;$sudo yum install grafana&lt;/code&gt; 命令直接安裝，內容如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[grafana]
name=grafana
baseurl=https://packagecloud.io/grafana/stable/el/6/$basearch
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://packagecloud.io/gpg.key https://grafanarel.s3.amazonaws.com/RPM-GPG-KEY-grafana
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section&quot;&gt;套件安裝細節說明如下：&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;執行檔安裝於 &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/sbin/grafana-server&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;建立起動程序檔 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/inint.d/grafana-server&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;安裝預設環境變數檔 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/sysconfig/grafana-server&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;建立預設組態設定檔 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/grafana/grafana.ini&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;安裝 systemd 服務(若系統使用systemd) &lt;code class=&quot;highlighter-rouge&quot;&gt;grafana-server.service&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;預設記錄檔路徑為 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/log/grafana/grafana.log&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;預設 grafana 使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;sqlite3&lt;/code&gt; 資料庫，檔案位置在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/grafana/grafana.db&lt;/code&gt;，當要升級 grafana 版本時記得先備份此檔案。 Grafana 亦支援使用 MySQL 或 Postgres 作為資料庫。&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-1&quot;&gt;啟動方式：&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;inid.d service&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo service grafana-server start

設定開機自動執行

$ sudo /sbin/chkconfig --add grafana-server
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;systemd&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ systemctl daemon-reload
$ systemctl start grafana-server
$ systemctl status grafana-server

設定開機自動執行

$ sudo systemctl enable grafana-server.service
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;不管是使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;init.d&lt;/code&gt; 或是 &lt;code class=&quot;highlighter-rouge&quot;&gt;systemd&lt;/code&gt; 方式啟動，皆會讀取 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/default/grafana-server&lt;/code&gt; 設定環境變數。&lt;/p&gt;

&lt;p&gt;系統會以名為 &lt;code class=&quot;highlighter-rouge&quot;&gt;grafana&lt;/code&gt; 的使用者來啟動 &lt;code class=&quot;highlighter-rouge&quot;&gt;grafana-server&lt;/code&gt; 程序，網頁介面預設使用 HTTP port &lt;code class=&quot;highlighter-rouge&quot;&gt;3000&lt;/code&gt;，預設使用者為 &lt;code class=&quot;highlighter-rouge&quot;&gt;admin&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;在 CentOS 7 中，開啟防火牆&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ firewall-cmd --permanent --add-port=3000/tcp
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;另外還有 SELinux 的問題，無法連線時先檢查&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sestatus          # 查看 selinux 狀態
$ setenforce 0      # 暫時使用 permissive 模式
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;debianubuntu&quot;&gt;Debian/Ubuntu&lt;/h2&gt;
&lt;p&gt;直接安裝最新穩定版&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ wget https://grafanarel.s3.amazonaws.com/builds/grafana-3.1.1-1470047149_amd64.deb
$ sudo apt-get install -y adduser libfontconfig
$ sudo dpkg -i grafana_3.1.1-1470047149_amd64.deb
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;或者將 grafana 加入套件庫清單，
建立 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/apt/sources.list&lt;/code&gt; 檔案，內容如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;deb https://packagecloud.io/grafana/stable/debian/ wheezy main

如果想使用開發版本:
deb https://packagecloud.io/grafana/testing/debian/ wheezy main

加入 Package Cloud key，允許安裝已簽署套件
$ curl https://packagecloud.io/gpg.key | sudo apt-key add -

使用下列命令安裝:
$ sudo apt-get update
$ sudo apt-get install grafana

版本較舊的 Debian/Ubuntu 可能需要加裝這個套件才能透過 HTTPS 取得套件：
$ sudo apt-get install -y apt-transport-https
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-2&quot;&gt;套件安裝細節說明如下：&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;執行檔安裝於 &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/sbin/grafana-server&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;建立起動程序檔 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/inint.d/grafana-server&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;安裝預設環境變數檔 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/default/grafana-server&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;建立預設組態設定檔 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/grafana/grafana.ini&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;安裝 systemd 服務(若系統使用systemd) &lt;code class=&quot;highlighter-rouge&quot;&gt;grafana-server.service&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;預設記錄檔路徑為 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/log/grafana/grafana.log&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;預設 grafana 使用 sqlite3 資料庫，檔案位置在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/grafana/grafana.db&lt;/code&gt;，當要升級 grafana 版本時記得先備份此檔案。 Grafana 亦支援使用 MySQL 或 Postgres 作為資料庫。&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-3&quot;&gt;啟動方式：&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;inid.d service&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo service grafana-server start

設定開機自動執行

$ sudo update-rc.d grafana-server defaults 95 10
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;systemd&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ systemctl daemon-reload
$ systemctl start grafana-server
$ systemctl status grafana-server

設定開機自動執行

$ sudo systemctl enable grafana-server.service
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Sat, 15 Oct 2016 19:29:00 +0800</pubDate>
        <link>http://robodock.github.io//2016/10/15/grafana-installation.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/10/15/grafana-installation.html</guid>
        
        
      </item>
    
      <item>
        <title>SRTM GeoTiff 數值地形檔案處理</title>
        <description>&lt;h2 id=&quot;srtm-geotiff-&quot;&gt;SRTM GeoTIFF 數值地形檔案處理&lt;/h2&gt;

&lt;h3 id=&quot;m--dem-&quot;&gt;下載 15m 精確度 DEM 數位高程資料&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;http://www.theearthsrelief.com/&quot;&gt;ClusterGIS Associate&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;geotiff--usgsdem&quot;&gt;GeoTIFF 檔案轉換為 USGSDEM&lt;/h3&gt;

&lt;p&gt;需要透過 GDAL 來處理，GDAL 主要在 Unix/Linux 環境下開發，在
Windows 環境下則可使用第三方編譯好的 GDAL binary 可執行檔，目前主要有 &lt;strong&gt;GISInternals&lt;/strong&gt;，&lt;strong&gt;MS4W&lt;/strong&gt;，&lt;strong&gt;OSGeo4W&lt;/strong&gt; 三處主要來源：&lt;/p&gt;

&lt;p&gt;下載地點連結:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;http://www.gisinternals.com/release.php&quot;&gt;GISInternals&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;http://www.ms4w.com/&quot;&gt;MS4W&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;https://trac.osgeo.org/osgeo4w/&quot;&gt;OSGeo4W&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;這裡以使用 GISInternals 來源為例，選擇適用的 CPU 與編譯器版本，若不使用其他套件，點進去後只要選取 core component 安裝。&lt;/p&gt;

&lt;p&gt;安裝完成後必須將 GDAL 的 bin 目錄加進系統路徑中，另新增一個名為 GDAL_DATA 的系統環境變數，並設定內容為 GDAL 的 gdal-data 目錄。&lt;/p&gt;

&lt;p&gt;如果想要利用 Python 來處理，則需要安裝 GDAL Python Library&lt;/p&gt;

&lt;p&gt;使用 Anaconda Python 者可用 conda 來安裝：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ conda install gdal
$ conda upgrade numpy
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;GeoTIFF 轉檔 DEM&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gdal_translate -of USGSDEM input.tif output.dem
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Wed, 05 Oct 2016 22:11:31 +0800</pubDate>
        <link>http://robodock.github.io//2016/10/05/geotiff-to-uscgdem.html</link>
        <guid isPermaLink="true">http://robodock.github.io//2016/10/05/geotiff-to-uscgdem.html</guid>
        
        
      </item>
    
  </channel>
</rss>
