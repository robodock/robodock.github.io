---
layout: post
title: "FreeNAS iSCSI"
---

簡單說明 FreeNAS 中 設定 iSCSI 應用的步驟。

這裏舉的例子是使用兩顆 1 TB 的 SATA 硬碟做成 RAID 1 mirror 組態。

選擇 `[儲存]`-`[磁區]`-`[ZFS Volume Manager]`，建立 ZFS 格式的 Volume，ZFS 的好處就不多說了，請自行 google。

簡單起見，直接使用兩顆硬碟的全部空間，注意執行 `Add Volume` 後硬碟上的資料將全部清除。這裏建立的 Volume Name 為 ZV。建好後可看到 `[磁區]` 項目下會多出 `/mnt/ZV`。

接下來便可在 Volume 中建立子區間，供進一步使用，主要有兩種格式，簡述如下：

*zvol* : 整個區塊空間，適合做為 **iSCSI** 使用，建立時指定名稱與大小即可。

*ZFS 資料集* : 邏輯儲存空間，設定時可指定分享格式(Share type)為 **UNIX**、**Windows** 或 **Apple** 的格式，以便後續設定為網路資料夾形式分享。(NFS、CIFS 與 AFP)。ZFS 資料夾下還可繼續有**子ZFS資料夾**。

##iSCSI 設定

在 FreeNAS 的 iSCSI 設定項目中，有許多特殊名詞，先對其用途作一簡單說明：

iSCSI 的運作中，供應磁碟空間這一方稱為 `**Target(目標)**`，像是 FreeNAS。

連接使用的一方稱為 `**Initiator(啟動器)**`，常為 Server 主機。

為了安全管理，需要在 FreeNAS 這端建立 `**入口**`，指定網卡的 IP 位址與連接埠(FreeNAS 上可有多張網卡介面)。

`**延伸磁區**` 設定要分享成 iSCSI 設備的磁區路徑。延伸磁區類型可由裝置或檔案構成。

`**啟動器**` 指定可連接 iSCSI 設備的啟動器與IP位址，設定前請先至欲連接 iSCSI 設備之主機上，進行啟動器(Initiator)相關設定，取得啟動器名稱，通常為 `iqn-20xx-xx-host.domain` 這樣的形式。若設定為 `ALL` 則表示不針對特定主機，所有主機皆可連接。

`**目標名稱**` 設定可供連接的目標名稱，設定參數有讀寫控管旗標、對應入口群組與啟動群組 ID。

`**授權連接**` 設定連接使用者帳號與密碼，更可加強安全性，目標與啟動器兩端都需有帳號密碼登入。
